\chapter{Problema de Agrupamento}

Agrupamento não apenas expressa o ato de separar dados em grupos, mas separa-los de modo que os elementos dos grupos resultantes tenham alguma, ou mais de uma, característica em comum entre si.
 Segundo Lorena e Furtado \cite{lorena2001constructive} ``problemas de
 agrupamento
 geralmente aparecem em classificação de dados para algum propósito como armazenar e
 recuperar ou analisar dados. Todo algoritmo de agrupamento tentará determinar algum
 agrupamento inerente ou natural nos dados, usando medidas de distância ou similaridade entre os dados.''.

Um exemplo bem simples de agrupamento seria o ato de separar poucas frutas de aparência boa das de
 aparência não tão boa dado uma medida de aparência.
 Para esse exemplo, um ser humano conseguiria executar a tarefa de forma
competitiva com um algoritmo, mas quando incluímos um grande de dados de entrada
e desejamos que sejam levadas em consideração outras medidas ou outras
restrições (ex. dividir em 10 grupos sendo 5 de frutas melhores além dos objetos
de cada grupo sejam de cores e tamanhos semelhantes), os algoritmos de
agrupamento podem chegar a uma solução muito melhor em menor tempo.

Dentre as aplicações práticas podemos destacar o uso de agrupamentos para data
mining,
 processamento de imagens, procura por padrões,
Redução de cores de imagens, localização de facilidades, reconhecimento de
padrões, alocação de tarefas a máquinas

Os problemas de particionamento podem ser organizados segundo a taxonomia
mostrada por \cite{jain1999data} reproduzida na figura \ref{clusterTaxonomy}.
\begin{figure}
 \begin{center}
\begin{tikzpicture}[mindmap, scale=0.85]
\begin{scope}[mindmap, concept color=orange, text=white]
\node [concept] {Agrupamentos} [clockwise from=-45]
  child{node [concept]{Hierárquico} [clockwise from=0]
    child{node [concept]{Link Simples}}
    child{node [concept]{Link Completo}}
  }
  child{node [concept]{Particionado}
    child{node [concept]{Erro dos Quadrados}[clockwise from=-45]
          child{node [concept]{K-Means}}
    }
    child{node [concept]{Grafo teórico}}
    child{node [concept]{Solução de Mistura} [clockwise from=-135]
        child{node [concept]{Expectativa de Maximização}}
    }
    child{node [concept]{Método de Busca}}
  }
;
\end{scope}
\end{tikzpicture}
\caption[Taxonomia dos problemas de agrupamento]
   {\label{clusterTaxonomy}Taxonomia para os problemas de agrupamento}
\end{center}
\end{figure}
Os problemas de particionamento, que serão aprofundados nesse trabalho, são
problemas onde é desejado descobrir partições nos conjuntos de dados de modo que
cada partição contenha apenas elementos similares entre si.

A escala de dificuldade de resolver do problema de particionamento, ser vista pela expressão de distintas partições $p$ existente em $n$ pontos,$N(n,p)$,
definida por \cite{liu1968cl}:
\begin{equation}
 N(p,n) = \frac{1}{p!}\sum_{i=0}^{p}(-1)^{p-1}\binom{p}{i}i^{n}
\end{equation}

Ahmadi e Osman apresentam em \cite{ahmadi2004density} um exemplo do resultado da
computação dessa expressão para uma instância com 50 pontos, o resultado pode
ser visto na imagem \ref{ahmadiCalc}.
\begin{figure}
 \begin{center}
 \includegraphics[scale=0.3]{./images/Ahmadi_Values_N_n_p.png}
 % Ahmadi_Values_N_n_p.png: 880x606 pixel, 96dpi, 23.28x16.03 cm, bb=0 0 660 454
\end{center}
\caption[Valores para N(n,p)]{\label{ahmadiCalc}Valores para N(n, p). No topo p
= 1 e na base p = 50.}
\end{figure}

Pode ser observado que mesmo para instâncias não tão grandes, o espaço
de busca é gigante. Quando consideramos instâncias maiores, como as resolvidas
por Taillard \cite{taillard2003heuristic}, onde são tratados 2863
pontos, o espaço de busca cresce ainda mais. O uso de métodos exatos é
proibitivo pelo tempo computacional que seria necessário para essas instâncias
maiores, e sendo esses problema da classe NP-Completo \cite{garey1979computers}
não existe um algoritmo que resolva de forma exata em tempo polinomial, o que
resta é o uso de métodos heurísticos e híbridos.
Outro fato sobre esses dados é que a ocorrência de mais agrupamentos possíveis,
ocorra com $p=16$, o que vem a mostrar que o problema é assimétrico em relação
a p.

Os problemas de agrupamentos por particionamento estão, do ponto de vista de
complexidade, entre os problemas combinatoriais mais difíceis de serem
resolvidos \cite{ahmadi2004density}

Quando temos um conjunto de pontos no espaço ($\Re^{2}$ por exemplo) e
desejamos agrupar os pontos pela sua  localização, podemos utilizar como
medida de dispersão dos grupos a distância dos pontos em relação ao centroide
calculado pelos pontos do agrupamento. Esse é também conhecido como Problema das
K-Médias (K-Means) apresentado por \cite{macqueen1966some}

O problema das P-Medianas é uma variação do problema das K-Médias, com a diferença de utilizar uma mediana (um dos indivíduos) como referência para medição das similaridades dos pontos de cada um dos agrupamentos.

Acrescentando a restrição de capacidade aos agrupamentos, temos o problemas das P-Medianas Capacitado ou também tratado na literatura por CCP.

\section{CCP - Problema de Agrupamento Capacitado}
Como já apresentado anteriormente, o CCP tem por objectivo agrupar indivíduos de modo a maximizar as similaridades entre entre todos indivíduos de um agrupamento e a mediana do próprio agrupamento. Para o caso dos indivíduos serem representados por pontos no $\Re^{2}$, temos como similaridade o posicionamento dos mesmos no plano, a qual é medida pela distância entre eles. Na Fig. \ref{fig:Exemplo-CCP} é apresentado um exemplo de uma possível solução do CCP dado um conjunto de pontos.

\begin{figure}
\begin{centering}
\includegraphics[scale=0.5]{../TCC-I/imagens/cluster_Density_SJC4a.png}
\par\end{centering}
\caption{\label{fig:Exemplo-CCP}Exemplo de uma solução do CCP}
\end{figure}

O problema de agrupamento capacitado pode ser visto como: dado um conjunto
$I$ de $n$ indivíduos com suas respectivas demandas $d_{i}\: i\in I$,
é desejado agrupar os $n$ pontos em $p$ agrupamentos, onde a soma
das demandas em cada agrupamento deve ser menor que a capacidade total
do agrupamento, $Q_{j},\:\forall j\in P$, sendo $P$ o conjunto de
agrupamentos, e é desejado minimizar as dissimilaridades entre uma mediana do
agrupamento, para isso possuímos uma matriz $c_{IxI}$ com as distâncias entre todos os pontos. O problema pode ser representado pela seguinte formulação matemática \cite{ahmadi2004density}:

\begin{equation}
Min\;\sum_{i\in P}\sum_{j\in I}c_{ij}x_{ij}\label{eq:obj_CCP}\end{equation}
Sujeito à:
\begin{equation}
\sum_{j\in p}x_{ij}=1,\;\forall i\in I\label{eq:1Cluster_CCP}\end{equation}
\begin{equation}
\sum_{j\in P}y_{j}=p\label{eq:numClusters_CCP}\end{equation}
\begin{equation}
x_{ij}\leq y_{j,\;}\forall i\in I,\:\forall j\in P\label{eq:mustAssign_CCP}\end{equation}
\begin{equation}
\sum_{i\in I}q_{i}x_{ij}\leq Q_{j},\;\forall j\in P\label{eq:capacity_CCP}\end{equation}
\begin{equation}
x_{ij},\: y_{j}\in\{0,1\},\;\forall i\in I,\;\forall j\in P\label{eq:sets_CCP}\end{equation}

Em (\ref{eq:obj_CCP}), temos a função objetivo que minimiza a distância
entre os componentes de cada agrupamento com a mediana do agrupamento. A medida $c_{ij}$, do ponto $i$ até o ponto $j$ (mediana do agrupamento), somente é considerada
se o ponto $i$ está associado ao agrupamento $j$ pela variável binária $x_{ij}$, sendo $x_{ij}=1$ caso o ponto $i$ esteja associado ao agrupamento $j$ e $0$ caso contrário. A restrição (\ref{eq:1Cluster_CCP}) indica que cada ponto deve estar associado a um agrupamento. Já (\ref{eq:numClusters_CCP}) indica que devem existir $p$ agrupamentos. Os indivíduos somente devem ser associados a agrupamentos existentes (\ref{eq:mustAssign_CCP}), sendo $y_{j}$ o conjunto de pontos escolhidos como medianas, sendo $y_{j}$ igual a 1 se $j$ for uma mediana e 0 caso contrário. Para garantir que a capacidade $Q_{j}$ de um agrupamento $j$ não será ultrapassado, é colocada a restrição (\ref{eq:capacity_CCP}). A última restrição, (\ref{eq:sets_CCP}), especifica as variáveis inteiras de decisão.

Quando temos o valor de capacidade dos agrupamentos homogêneo, ou
seja, o valor de $Q_{j}=Q_{i}\:,\forall j\: e\:\forall i\in P$, podemos
dizer que esse é um problema das $p-medianas$ capacitado.

\subsection{CCCP}\sigla{CCCP}{Problema de Agrupamento Centrado Capacitado - Capacitated Centred Clustering Problem}
Um outro problema de agrupamento foi proposto por Negreiro e Palhano\cite{negreiros2006capacitated}
é o CCCP (Capacitated Centred Clustering Problem - Problema de agrupamento
centrado capacitado) onde os agrupamentos passam a ter seu centro
não necessariamente em um ponto (mediana), mas no centroide calculado
entre os pontos pertencentes a cada agrupamento.

são propostas 2 variações do problema, $p-CCCP$, onde é dado o número
de agrupamentos que se deseja encontrar, e $g-CCCP$ (generic - CCCP)
que se deseja encontrar o menor número de agrupamentos para atender
a todas demandas, sendo a função objetivo em ambas a minimização das
dissimilaridades entre os componentes de cada agrupamento.

Na figura \ref{fig:CCCP} é apresentada a visualização de uma solução
para o problema $CCCP$.

%
\begin{figure}
\begin{centering}
\includegraphics{../TCC-I/imagens/CCCP}
\par\end{centering}

\caption{\label{fig:CCCP}Uma solução para CCCP \cite{negreiros2006capacitated}}
\end{figure}


A primeira, $p-CCCP$, possui o número fixo de agrupamentos que se
deseja encontrar e a segunda variação, $g-CCCP$, assume que para
cada novo agrupamento adicionado, é acrescentado um valor de penalização
na função objetivo, levando a minimização de agrupamentos. A definição
para o $p-CCCP$ é:

\begin{equation}
min\sum_{i\in I}\sum_{j\in P}\parallel a_{i}-\overline{g_{j}}\parallel^{2}x_{ij}\label{eq:obj_CCCP}\end{equation}
Sujeito à,

\begin{equation}
\sum_{j\in P}x_{ij}=1,\;\forall i\in I,\label{eq:1Cluster_CCCP}\end{equation}
\begin{equation}
\sum_{i\in I}x_{ij}=n_{j},\;\forall j\in P,\label{eq:nPerCluster_CCCP}\end{equation}
\begin{equation}
\sum_{i\in I}a_{i}x_{ij}=n_{j}\overline{g_{j}},\;\forall j\in P,\label{eq:centroid_CCCP}\end{equation}
\begin{equation}
\sum_{i\in I}q_{i}x_{ij}\leq Q_{j},\;\forall j\in P,\label{eq:capacity_CCCP}\end{equation}
\begin{equation}
a_{i}\in\Re^{l},\;\overline{g_{j}}\in\Re^{l},\; n_{j}\in N,\; x_{ij}\in\{0,1\},\;\;\forall i\in I,\;\forall j\in P,\label{eq:sets_CCCP}\end{equation}

onde, $\overline{g_{j}}$ é o centroide do agrupamento $j$, $n_{j}$o
número de indivíduos associados ao agrupamento $j$, $a_{i}$a posição
do indivíduo $i$ no espaço $\Re^{l}$, $q_{i}$a demanda do indivíduo
$i$, $Q_{j}$ a capacidade de cada agrupamento, $I$ o conjunto de
indivíduos e $P$ o conjunto de agrupamentos.

A função objetivo (\ref{eq:obj_CCCP}) tem como diferencial em relação
ao problema clássico $CCP$, o fato das similaridades serem medidas
em relação a todos pontos do agrupamento até seu centroide, o qual
não é necessariamente um indivíduo. A eq. (\ref{eq:1Cluster_CCCP})
indica que um indivíduo somente pode estar associado a um agrupamento,
e a restrição (\ref{eq:nPerCluster_CCCP}) associa a $n_{j}$o número
de indivíduos no agrupamento $j$. Em (\ref{eq:centroid_CCCP}) é
definido todos os centroides dos respectivos agrupamentos e em (\ref{eq:capacity_CCCP})
é colocado que cada agrupamento não pode maior demanda dos indivíduos
que sua própria capacidade. A ultima restrição (\ref{eq:sets_CCCP})
indica o domínio das variáveis do problema.

No $g-CCCP$ o número de agrupamentos não é definido a priori, mas
tem um limitante inferior dado por $\lceil\sum_{i\in I}q_{i}/\sum_{j\in P}Q_{j}\rceil$.
Esse problema a seguinte formulação:
% \begin{singlespace}
\begin{eqnarray}
Min &\;& \left(F\sum_{j\in P}z_{j}\right)+\sum_{j\in P}\left(\sum_{i\in I}\parallel a_{i}-\overline{g_{j}}\parallel^{2}x_{ij}\right)\label{eq:obj_g-CCCP} \\
Sujeito\;A,&& \\
\sum_{j\in P}x_{ij} &=& 1,\;\forall i\in I,\label{eq:1Cluster_g-CCCP} \\
\sum_{i\in I}a_{i}x_{ij} &=&  \overline{g_{j}}\left(\sum_{i\in I}x_{ij}\right),\;\forall j\in P,\label{eq:centroid_g-CCCP} \\
\sum_{i\in I}q_{i}x_{ij} &\leq& Q_{j}z_{j},\;\forall j\in P,\label{eq:capacity_g-CCCP}  \\
\overline{g_{j}}&\in&\Re^{l},\: z_{j},\: x_{ij}\in\{0,1\},\;\forall i\in I,\forall j\in P,\label{eq:sets_g-CCCP}
\end{eqnarray}
% \end{singlespace}
onde, $z_{j}=1$ se o agrupamento $j$ está aberto (em uso), $0$
caso contrário, $Q_{j}$ a capacidade do agrupamento $j$, $q_{i}$a
demanda o indivíduo $i$, $\overline{g_{j}}$ o centroide do agrupamento
$j$. $F$ é o custo fixo para abrir um novo agrupamento.

A função objetivo (\ref{eq:obj_g-CCCP}) minimiza as dissimilaridades
entre os integrantes de um mesmo agrupamento além do número total
de agrupamentos abertos. A eq. (\ref{eq:1Cluster_g-CCCP}) define
que um indivíduo somente pode estar associado a um agrupamento, (\ref{eq:centroid_g-CCCP})
encontra o centroide de cada agrupamento e (\ref{eq:capacity_g-CCCP})
garante que a capacidade dos agrupamentos não sejam ultrapassados.
As ultimas restrições (\ref{eq:sets_g-CCCP}) especificam as variáveis
de decisão.


\section{Métodos de resolução}
Devido a características como o tamanho de espaço de busca, a resolução de problemas de particionamento utilizando métodos exatos ou de otimização como \emph{branch and bound} são inefetivos em instâncias maiores \cite{osman1994capacitated}.

Para obter soluções em tempos computacionais viáveis (por exemplo no caso do PDOS, uma solução não poderia levar mais que 8 horas para ser processada), é necessário a utilização de heurísticas. Métodos heurísticos podem não gerar uma solução ótima, ou mesmo próxima dela, mas conseguem gerar soluções muito boas em um tempo computacional polinomial.

Podemos distinguir 2 tipos de heurísticas\cite{osman1994capacitated}:
\begin{itemize}
 \item Construtivas: Algoritmos desenvolvidos especificamente para uma determinada classe de problemas. Normalmente as soluções estão em um ótimo local ou muito próximo de um;
 \item Iterativas: A partir de uma solução inicial válida, e busca na vizinhança iterativamente por outras soluções melhores. A busca na vizinha normalmente conduz a um vale/pico, chegando a um ótimo local ao final das iterações.
\end{itemize}