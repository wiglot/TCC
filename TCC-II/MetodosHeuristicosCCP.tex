\chapter{Metodos Heurísticos para o CCP}
% ##################Falar sobre todos os métodos estudados

O CCP, é descrito na literatura como um problema $\mathcal{NP}-completo$\cite{osman1994capacitated},
não existindo algoritmos em tempo polinomial para resolver o problema.
Para os métodos exatos, que apresentam melhores soluções, eles somente
podem ser utilizados para instância pequenas (<100 indivíduos), uma
vez que é um problema de programação inteira e o numéro de variaveis
de decisão é da ordem de $n^{2}+n$\cite{RePEc:eee:ejores:v:18:y:1984:i:3:p:339-348},
onde $n$ é o número pontos de demanda do problema. Para instâncias
muito grandes, o uso de heurísticas traz soluções muito boas, algumas
vezes muito próximas aos métodos exatos. Serão apresentadas algumas
heurísticas para construção de uma solução inicial do problema de
agrupamento, a qual poderá ser evoluida com algumas técnicas:
\begin{description}
\item [{CCP}]~

\begin{description}
\item [{Farthest:}] Proposta por Osman e Christofides em \cite{osman1994capacitated},
tem como base escolher os pontos mais afastados para serem os primeiros
centros
\item [{Density:}] Proposta por Ahmadi e Osman em \cite{ahmadi2004density},
visa construir uma solução inicial usando a densidade de pontos para
construir a solução inicial.
\end{description}
\item [{CCCP}]~

\begin{description}
\item [{Balanced}] q-trees: que utiliza de arvores q-trees e métodos como
k-means, Forgy, entre outros
\item [{Unconstrained}] to Constrained: inicia como uma solução infactível
alterando-a até conseguir uma solução factível. Ambos métodos para
CCCP apresentados em \cite{negreiros2006capacitated};
\end{description}
\end{description}

\subsection{CCP}

Para o problema de agrupamento capacitado (CCP), apresentamos 2 heurísticas:


\subsubsection{Farthest}

Osman e Christofides apresentaram a heuristica construtiva com base
no afastamento inicial dos primeiros centros (mais afastados entre
sí) e após um recálculo dos centros de cada agrupamento. Essa é uma
heuristica muito rápida mas que pode não encontrar soluções factíves
para o caso de a soma de todas demandas seja muito próxima das capacidades
de todos agrupamentos. A heurística pode ser apresentada da seguinte
forma:
\begin{itemize}
\item Passo 1 - encontre os pontos $(i,j)$ mais afastados entre sí, então
$C={i,j}$

\begin{itemize}
\item Se número desejado de agrupamentos (p) = 2, vá para o passo 3.
\end{itemize}
\item Passo 2 - enquanto |C| < número desejado de agrupamento, faça

\begin{itemize}
\item Encontre um cento $k\in O-C$, de modo que:
\end{itemize}
\[
\prod_{j\in C}d_{kj}=\max_{_{k\in O-C}}\;\;\prod_{j\in C}d_{kj}\]

\begin{itemize}
\item Então faça $C=C\cup k$;
\end{itemize}
\item Passo 3 - Para cada consumidor, encontre a distância até o centro
mais próximo. Organize estas distâncias em ordem crescentedo. Atribua
os consumidores na ordem dessas distâncias aos centros correspondentes,
se a capacidade permitir, caso contrário, atribua para o centro mais
próximo disponível.
\item Passo 4 - Recalcule os centros dos agrupamentos de modo a minimizar
as distância entre os pontos e o novo centro.
\end{itemize}
Essa heuristica tem como objetivo a construção rápida de uma solução
e para se obter melhores soluções deve-se empregar heuristicas de
busca na visinhança da solução obtida com essa heuristica construtiva.
Em \cite{osman1994capacitated} é apresentado um metodo hibido que
combina Busca tabu e simulated annealing.


\subsubsection{Density}

Para resolver um problema de agrupamento uma abordagem possível para
escolha dos centros iniciais é a escolha dos centros que possuam uma
maior densidade de pontos, assim a distância entre esse centro candidato
e os possíveis pontos componentes será minimizada. Essa abordagem
tem carater guloso e é miope por escoher os pontos candidatos a centros
vendo apenas sua densidade sem prever o rumo que essa solução está
tomando. Para corrigir isso, é apresentado um método baseado na idéia
de densidade dos pontos, mas que utiliza de aspectos computação adaptativa
com uma contrução-desconstrução periódica. Essa meta-heuristica construtiva
apresenta solucçoes muito boas em uma iteração, sendo as melhoras
sobre a solução dada por uma procura no espaço do problema através
de alterações nas distâncias e e geração de novas soluções.

Para a etapa construtiva da solução, existem os seguintes métodos:
\begin{itemize}
\item EncontraVizinhos: Encontra os $m_{i}$vizinhos mais próximos de ponto
$i$, sendo que $m_{i}\leq\frac{n}{p}$ e todos os pontos $Y_{i}$
(conjunto de pontos vizinhos do centro $i$) tem a soma de suas demandas
inferior ou igual a capacidade do agrupamento $i$.
\item CalculaDensidade: Com o conjunto de pontos vizinhos do centro $i$,
conseguimos calcular a densidade do centro através de
\end{itemize}
\[
D_{i}=\frac{m_{i}}{T(a_{i},Y_{i})}\]


sendo $T(a_{i},Y_{k})$ a função que devolve a distância total de
do ponto $a_{i}$ até todos os pontos de $Y_{k}$.
\begin{itemize}
\item CalculaArrependimento: Após encontrados os pontos candidatos a centros,
é necessário definir os pontos que serão atribuidos a cada um dos
agrupamentos. Para essa inserção, é utilizada essa função para calcular
o arrependimento de associar um nó com um centro que não seja o mais
próximo. Para um ponto $i$, tendo os pontos $j_{1}\; e\; j_{2}$
como o centro mais próximo a $i$ e segundo mais próximo, respectivamente,
calculamos o arrependimento de associar $i$ com um centro que não
seja $j_{1}$ como sendo:
\end{itemize}
\[
R_{i}=d_{ij_{2}}-\; d_{ij_{1}}\]

\begin{itemize}
\item EncontreOsMelhoresAgrupamentos (C, A): tendo A como um conjunto de
pontos e C o conjunto de centros. Essa função tenta associar os pontos
em A com os agrupamentos em C e está descrita em \ref{alg:;EncontreOsMelhoresAgrupamentos}.
\end{itemize}
%
\begin{algorithm}[h]
\caption{EncontreOsMelhoresAgrupamentos(C,A)\label{alg:;EncontreOsMelhoresAgrupamentos}\protect \\
}


$t=1$;

Minor $\leftarrow$ Máximo de iterações;

$alterado\leftarrow Verdadeiro$;

Enquanto ($alterado=Verdadeiro$ E $t<Minor$)

Faça:

~~~~~~$alterado\leftarrow False$;

~~~~~~1: Atribua todos os centros aos seus agrupamentos;

~~~~~~2: Calcule o arrependimento de todos os pontos em $A$;

~~~~~~3: Encontre o maior $R_{i}$ não atribuido;

~~~~~~4: Atribua $i$ para o agrupamento mais próximo disponível;

~~~~~~5: Atualiza $A$ com os pontos atribuidos;

~~~~~~6: Se $A\neq\emptyset$, vá para 2;

~~~~~~Para cada $C_{j}$ e seu centro $c_{j}$

~~~~~~~~~~~para cada $a_{i}\in C_{j}$

~~~~~~~~~~~~~~~~Se ($T(a_{i},C_{j})$$<T(c_{j},C_{j})$)

~~~~~~~~~~~~~~~~~~~~Atualize o novo centro de
$C_{j}$ como $a{}_{i}$;

~~~~~~~~~~~~~~~~~~~~$alterado\leftarrow Verdadeiro$;

~~~~~~~~~~~~~~~~FimSe;

~~~~~~~~~~FimPara;

~~~~~~FimPara;

~~~~~~$t\leftarrow t+1$;

FimFunção.
\end{algorithm}


Com as funções definidas, um procedimento principal é chamado e apresenta
ao final o conjunto dos agrupamentos $C$. Em \ref{alg:ProcedimentoDensidade}
é apresentado tal procedimento o qual implementa a computação adaptativa.
De modo iterativo, esse método vai construindo um agrupamento por
vez e recalculando a densidade ($D)$ e arrependimento ($R$) do conjunto.

%
\begin{algorithm}[h]
\caption{{ProcedimentoPrincipal}\label{alg:ProcedimentoDensidade}\protect \\
}


I: conjunto de $n$ pontos

C: conjunto de centros

X: conjunto de pontos não atribuidos em A

Z: conjunto de pontos atribuidos até iteração $k$

$Y_{i}$: conjunto dos $m_{i}$ pontos próximos a $a_{i}$, dado pela
função $EncontraVizinhos$

Passo 1:

$k=0;$

$X=A,\, C=\emptyset,\, Z=\emptyset$

Passo 2:

$k\leftarrow k+1;$

Para cada $a_{i}\in X$, encontre o conjunto $m_{i}$, $Y_{i}\subseteq X$;

Calcule a densidade ($D_{i}$) para cada $a_{i}\in X$;

Selecione o maior $D_{i}$ e atribua $a_{i}$ como centro do centro
do $k$-ésimo agrupamento, $C_{k}=C_{k}\cup a_{i}$;

Elimine os pontos selecionados das próximas seleções: $X=X\setminus Y_{i}$,
$Y=Y\cup Y_{i}$;

Se $k\geq2$ então chame $EncontreOsMelhoresAgrupamentos(C,Y)$;

Se $k<p$ então volte ao passo 2;

$EncontreOsMelhoresAgrupamentos(C,A)$
\end{algorithm}


Uma comparação entre as soluções geradas pelas heurísticas pode ser
visto na figura \ref{fig:CCP-compara=0000E7=0000E3o}. A Instância
é a mesma aplicada em ambos casos. Como podemos ver, a heurística
de densidade apresenta um solução melhor, apesar do tempo de processamento
ser muito alto pela complexidade do algoritmo.

% %
% \begin{figure}[h]
% \begin{centering}
% \includegraphics[scale=0.5]{imagens/cluster_Density_SJC4a}\includegraphics[scale=0.5]{imagens/cluster_Farthest_SJC4a}
% \par\end{centering}
%
% \caption{\label{fig:CCP-compara=0000E7=0000E3o}A solução gerada pela heurística
% density (esquerda) possui os agrupamentos bem mais compactos que na
% solução pela heurística farthest (direita).}
%
%
%
% \end{figure}
\subsection{Busca Local}
Apartir dos resultados obtidos anteriormente, como é e o que um método de busca local pode fazer
