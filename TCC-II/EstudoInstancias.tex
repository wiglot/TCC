\chapter{Estudo das Características das Instâncias}
Chamamos de razão da soma das demanda por a capacidade total oferecida. Para comparar entre as diferentes instâncias, utilizamos a formula \ref{folga}:
% \begin{equation}
\begin{align}
 F &= \frac{\sum_{p\in P} p_{cap} }{\sum_{i \in I} i_{dem}} \label{folga}
\end{align}

Onde $i_{dem}$ é a demanda do indivíduo $i$ e $p_{cap}$ a capacidade do agrupamento $p$. $F$ é maior que 1 se a demanda total é menor que a capacidade total. Para valores de $F$ muito próximos a 1, mas maiores que 1, as heurísticas tendem a não conseguir nem mesmo uma solução factível, principalmente heurísticas que utilizam de procedimentos gulosos para alocação de indivíduos, como por exemplo a escolha do agrupamento com mediana mais próxima do indivíduo a ser alocado. Para valores menores que 1 não existe uma solução válida para a instância, uma vez que existe maior demanda que oferta (capacidade).

Para o caso de $ \sum_{i \in I} i_{dem} \geq p_{cap},\forall p \in P $ podemos dizer que o problema é equivalente ao problemas das P-medianas não capacitado, uma vez que a capacidade não chega a ser uma restrição no problema e todos os indivíduos podem ser associados a apenas uma agrupamento.

Essa ultima colocação mostra o quanto o valor de folga pode interferir na geração de soluções das instâncias.
Nas instâncias inéditas apresentadas aqui, modificamos a folga de modo a ser possível analisar e registrar o comportamento dos algoritmos e os valores da função objetivo das soluções obtidas. A tabela \ref{tab:varDemandas} mostra as demandas médias, bem com os valores mínimos e máximos, e a folga de cada uma das instâncias.


\begin{threeparttable}
\centering
\caption {\\variação das demandas dos indivíduos das instâncias.\label{tab:varDemandas}}
\begin{tabular}{lrrrr} \hline

Instância&   Folga &   $D_{Med}$\tnote{1}  &   $D_{Min}$\tnote{2} &   $D_{Max}$\tnote{3} \\
\midrule
SJC1    &1,23988    &58,07  &1  &654 \\
SJC2    &1,35937    &46,345 &1  &654 \\
SJC3a   &1,64371    &37,5167    &1  &654 \\
SJC3b   &1,97246    &37,5167    &1  &654 \\
SJC4a   &1,57658    &39,7612    &1  &654 \\
SJC4b   &2,1021 &39,7612    &1  &654 \\
SJC5    &1,05105    &39,7612    &1  &654 \\
AEAL\_10 &1,1    &22,7321    &3  &52 \\
AEAL\_20 &1,2    &22,7321    &3  &52 \\
AEAL\_30 &1,3    &22,7321    &3  &52 \\
AECP\_10 &1,1    &22,2222    &3  &52 \\
AECP\_20 &1,2    &22,2222    &3  &52 \\
AECP\_30 &1,3    &22,2222    &3  &52 \\
AELJ\_10 &1,1    &22,6192    &3  &122 \\
AELJ\_20 &1,2    &22,6192    &3  &122 \\
AELJ\_30 &1,3    &22,6192    &3  &122 \\
AENH\_10 &1,1    &23,2514    &3  &122 \\
AENH\_20 &1,2    &23,2514    &3  &122 \\
AENH\_30 &1,3    &23,2514    &3  &122 \\
AESM\_10 &1,1    &25,0175    &3  &52 \\
AESM\_20 &1,2    &25,0175    &3  &52 \\
AESM\_30 &1,3    &25,0175    &3  &52 \\
\bottomrule
\end{tabular}
\begin{tablenotes}
 \item[1]Demanda média dos indivíduos
 \item[2]Demanda mínima dos indivíduos
 \item[3]Demanda máxima dos indivíduos
\end{tablenotes}
\end{threeparttable}

Para medir a dispersão dos indivíduos no espaço, Desenvolvemos um método que mede a distância dos pontos de centros de massa calculados usando como peso para cada ponto sua própria demanda. O algoritmo \ref{algMedia} produz como resultado a média das distâncias dos pontos aos centroides e as distâncias mínima e máxima. Para o primeiro centro de massa todos os pontos são considerados. Já para os demais centros de massa, os pontos mais próximos ao último  centro de massa calculado que possuam a soma de suas demandas inferior ou igual a capacidade $Cap$, são removidos do cálculo do próximo centro de massa.

\begin{algorithm}
\caption{CalculaDispersão(I, Cap)}\label{algMedia}
 \begin{algorithmic}
  \STATE $S \leftarrow I $
  \STATE $MinD \leftarrow \infty $
  \STATE $MaxD \leftarrow 0 $
  \STATE $MedD \leftarrow 0 $
  \STATE $NumC \leftarrow o $

  \WHILE{$S \neq \emptyset $}
      \STATE $C \leftarrow CentroDeMassa(S)$
      \STATE $V \leftarrow EncontraVizinhos(C,S, Cap)$
      \FORALL {$v \in V$}
      \STATE $MinD \leftarrow Min(MinD, d(v,C))$
      \STATE $MaxD \leftarrow Max(MaxD, d(v,C))$
      \STATE $MedD \leftarrow MedD + d(v,C)$
      \ENDFOR
      $NumC \leftarrow NumC + 1$
      $S \leftarrow S - V$
\ENDWHILE
\STATE $MedD \leftarrow MedD/NumC $
\end{algorithmic}
\end{algorithm}

O método EncontraVizinhos, apresentado no algoritmo \ref{alg:EncVizinhos}, procura os pontos mais próximos do centroide $C$ dentre os pontos no conjunto $S$. Para isso é respeitada a capacidade $Cap$ passada.

\begin{algorithm}
\caption{EncontraVizinhos(C,S, Cap)}\label{alg:EncVizinhos}
 \begin{algorithmic}
  \STATE $acum \leftarrow 0 $
  \STATE $k \leftarrow 0 $
  \STATE $list \leftarrow \empty$
  \FORALL {$i \in S$}
  \STATE Map.insert(d(i,C), i)
  \ENDFOR
  \WHILE{$\mid Map\mid \neq 0 \;\AND\; Map[k].demanda + acum \leq Cap$ }
  \STATE $list \leftarrow Map[k] \cup list$
  \STATE $acum \leftarrow acum + Map[k].demanda$
  \STATE $k \leftarrow k + 1$
  \ENDWHILE
  \RETURN list
 \end{algorithmic}

\end{algorithm}

Para encontrar o centro de massa, as coordenadas (x e y) dos pontos pertencentes a $S$ são somadas e multiplicadas pela sua demanda. O valor final é dividido pelo número de pontos em $S$ e é criado um ponto com a localização resultante. O algoritmo que executa tal processamento é apresentado em \ref{alg:CentroDeMassa}.

\begin{algorithm}
\caption{CentroDeMassa(S)}\label{alg:CentroDeMassa}
 \begin{algorithmic}
  \STATE $X \leftarrow 0 $
  \STATE $Y \leftarrow 0 $
  \STATE $dem \leftarrow 0$
  \FORALL {$i \in S$}
  \STATE $X \leftarrow X + i.x \cdot i.demanda$
  \STATE $Y \leftarrow Y + i.y \cdot i.demanda$
  \STATE $dem \leftarrow dem + i.demanda $
  \ENDFOR
  \RETURN Ponto($\frac{X}{dem},\frac{Y}{dem}$)
 \end{algorithmic}
\end{algorithm}


Aplicando o algoritmo sobre as instâncias, obtivemos os dados apresentados na tabela \ref{tab:dispersao}. Colocamos também o gráfico \ref{fig:dispersao} dos dados para melhor visualização. Para comparar as dispersão entre as diferentes instâncias, os valores foram normalizados por $Max(d(i,k)),\;i,k\in I$, sendo 1 a maior distâncias entre 2 pontos de uma instância. O que nós tomamos como medida de dispersão é a medida média de distâncias, apesar da medida mínima e máxima indicar algumas peculiaridades das instâncias, como por exemplo a distância máxima muito alta e a distância média e distância mínima muito baixa pode indicar o que os pontos se encontram agrupados bem próximos, mas que exitem pontos isolados (afastados) dessas concentrações.

\begin{figure}[hp]
 \centering
 \includegraphics[bb=0 0 589 448, scale=0.7]{./images/graphicdispersion.png}
 % graphicdispersion.png: 785x598 pixel, 96dpi, 20.77x15.82 cm, bb=0 0 589 448
 \caption{Dispersão dos indivíduos nas instâncias}
 \label{fig:dispersao}
\end{figure}


\begin{threeparttable}[htp]
\centering
\caption {\\Dispersão dos indivíduos nas instâncias.\label{tab:dispersao}}
\begin{tabular}{lrrrr} \hline
Instância   &\multicolumn{1}{c}{$D_{min}$\tnote{1}}     &\multicolumn{1}{c}{$D_{max}$\tnote{2}}    &\multicolumn{1}{c}{$D_{med}$\tnote{3} }   &\multicolumn{1}{c}{CM\tnote{4}} \\
\midrule
SJC1         &0,01348  &0,5895   &0,1937   &10 \\
SJC2         &0,02145  &0,7027   &0,2725   &12 \\
SJC3a        &0,00402 &0,7217   &0,2576   &17 \\
SJC3b        &0,00402 &0,7217   &0,2576   &17 \\
SJC4a        &0,02442  &0,6849   &0,2844   &21 \\
SJC4b        &0,02442  &0,6849   &0,2844   &21 \\
SJC5         &0,02442  &0,6849   &0,2844   &21 \\
AEAL\_10     &0,00627 &0,5366   &0,2048   &14 \\
AEAL\_20      &0,00620 &0,5337   &0,2004   &13 \\
AEAL\_30      &0,00621 &0,6475   &0,1945   &12 \\
AECP\_10      &0,04394   &0,4484   &0,2864   &10 \\
AECP\_20      &0,01667   &0,5008   &0,2689   &9 \\
AECP\_30      &0,14215   &0,7061   &0,2848   &8 \\
AELJ\_10      &0,01586  &0,5326   &0,1293   &13 \\
AELJ\_20      &0,01586  &0,5513   &0,1317    &12 \\
AELJ\_30      &0,01586  &0,5227   &0,1315   &11 \\
AENH\_10      &0,00690  &0,5209   &0,0873  &16 \\
AENH\_20      &0,00690  &0,6348    &0,0766  &15 \\
AENH\_30      &0,00690  &0,6889   &0,0821  &14 \\
AESM\_10      &0,00409  &0,8907   &0,0334  &20 \\
AESM\_20      &0,00409  &0,9446   &0,0333  &18 \\
AESM\_30    &0,00409  &0,8907   &0,0352  &17 \\
\bottomrule
\end{tabular}
\begin{tablenotes}
 \item[1]Distância mínima dos indivíduos até seu o centro de massa
 \item[2]Distância máxima dos indivíduos até seu o centro de massa
 \item[3]Distância média dos indivíduos até seu o centro de massa
 \item[4]Número de centros de massa calculados
\end{tablenotes}
\end{threeparttable}

Na figura \ref{fig:instances} é apresentado algumas instâncias onde é possível perceber que o cálculo de dispersão se encontra bastante coerente com a localização dos indivíduos. A instância SJC4a é umas das que apresentou maior média de distância dos centros de massa para os indivíduos e como pode ser visto na figura \ref{fig:sjc4} os indivíduos são distribuídos quase que uniformemente no espaço. Já a instância AECP, apesar de apresentar focos de concentração de pontos, existem vários desses focos o que leva os centros de massa serem calculados entre esses focos afastados das concentrações, e assim ter uma maior distância entre os pontos e os centros de massa. As duas instâncias com menores médias de distâncias foram AENH(\ref{fig:aenh}) e AESM(\ref{fig:aesm}) possuem apenas um grande foco de concentração dos pontos, sendo nesse caso onde se concentrará a maioria dos centros de massa calculados.

\begin{figure}[hp]
 \centering
\subfloat[Instância AECP]{
 \includegraphics[bb=0 0 229 482,scale=0.5]{./images/AECP.png}
 % AECP.png: 305x643 pixel, 96dpi, 8.07x17.01 cm, bb=0 0 229 482
 \label{fig:ascp}
}
\subfloat[Instância AENH]{
 \includegraphics[bb=0 0 378 367,scale=0.5]{./images/AENH.png}
 % AENH.png: 504x490 pixel, 96dpi, 13.33x12.96 cm, bb=0 0 378 367
 \label{fig:aenh}
}\\
\subfloat[Instância AESM]{
 \includegraphics[bb=0 0 359 367, scale=0.5]{./images/AESM.png}
 % AESM.png: 479x489 pixel, 96dpi, 12.67x12.94 cm, bb=0 0 359 367
 \label{fig:aesm}
}
\subfloat[Instância SJC4a]{
 \includegraphics[bb=0 0 375 351,scale=0.5]{./images/SJC4a.png}
 % SJC4a.png: 500x468 pixel, 96dpi, 13.23x12.38 cm, bb=0 0 375 351
 \label{fig:sjc4}
}
\caption{Localização dos pontos de algumas instâncias}\label{fig:instances}
\end{figure}


